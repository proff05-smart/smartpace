{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="container mt-4">
<!-- Quiz Attempt Stats -->
<div class="small text-muted mb-2">
  <p class="mb-0">
    You have attempted this quiz <strong>{{ user_attempt_count }}</strong> time(s) today.
  </p>
{% if user.is_staff or user.is_superuser %}
  <p>Total unique users today: <strong>{{ total_users_today }}</strong></p>

  <!-- Correct Answers -->
  <h6 class="text-success">✅ Correct Answers</h6>
  <ul class="list-inline">
    {% for attempt in correct_users_today %}
      <li class="list-inline-item text-center">
        {% if attempt.user.profile.photo %}
          <img src="{{ attempt.user.profile.photo.url }}" alt="{{ attempt.user.username }}"
               class="rounded-circle" width="40" height="40">
        {% else %}
          <img src="{% static 'img/default-avatar.png' %}" alt="{{ attempt.user.username }}"
               class="rounded-circle" width="40" height="40">
        {% endif %}
        <div class="small">{{ attempt.user.username }}</div>
      </li>
    {% empty %}
      <li>No correct answers yet today.</li>
    {% endfor %}
  </ul>

  <!-- Wrong Answers -->
  <h6 class="text-danger">❌ Wrong Answers</h6>
  <ul class="list-inline">
    {% for attempt in wrong_users_today %}
      <li class="list-inline-item text-center">
        {% if attempt.user.profile.photo %}
          <img src="{{ attempt.user.profile.photo.url }}" alt="{{ attempt.user.username }}"
               class="rounded-circle" width="40" height="40">
        {% else %}
          <img src="{% static 'img/default-avatar.png' %}" alt="{{ attempt.user.username }}"
               class="rounded-circle" width="40" height="40">
        {% endif %}
        <div class="small">{{ attempt.user.username }}</div>
      </li>
    {% empty %}
      <li>No wrong answers yet today.</li>
    {% endfor %}
  </ul>
{% endif %}





  <!-- Quiz Title -->
  <h2 class="fw-bold mb-3">{{ quiz.title }}</h2>
  
  <!-- Question -->
  <p class="lead">{{ quiz.question }}</p>

  {% if quiz.image %}
    <img src="{{ quiz.image.url }}" alt="Quiz Image" class="img-fluid rounded mb-3 shadow-sm">
  {% endif %}

  <!-- Feedback Display (After Submission) -->
  {% if feedback %}
    <div class="alert alert-{{ feedback.type }} fw-bold">
      {{ feedback.message }}
    </div>
  {% endif %}

  <!-- Quiz Form -->
  <form method="post" class="mt-3">
    {% csrf_token %}
    {% for option, label in options %}
      <div class="form-check mb-2">
        <input class="form-check-input" type="radio" name="answer" value="{{ option }}" id="option{{ option }}"
          {% if selected_option == option %}checked{% endif %}
          {% if feedback %}disabled{% endif %}>

        <label class="form-check-label
          {% if feedback %}
            {% if option == feedback.correct_answer %} text-success fw-bold
            {% elif option == selected_option %} text-danger fw-bold
            {% endif %}
          {% endif %}
        " for="option{{ option }}">
          {{ option }}. {{ label }}
          
          {% if feedback %}
            {% if option == feedback.correct_answer %}
              <span class="ms-1 text-success">&#10004;</span>
            {% elif option == selected_option %}
              <span class="ms-1 text-danger">&#10008;</span>
            {% endif %}
          {% endif %}
        </label>
      </div>
    {% endfor %}

    {% if not feedback %}
      <button type="submit" class="btn btn-primary mt-3">Submit Answer</button>
    {% endif %}
  </form>

  <!-- Explanation (After Submission) -->
  {% if feedback %}
    <div class="mt-4">
      <h5 class="fw-bold">Explanation:</h5>
      <p>{{ quiz.explanation|striptags }}</p>

    </div>

    <!-- Navigation Buttons -->
    <div class="mt-4 d-flex justify-content-between">
      {% if prev_question_id %}
        <a href="{% url 'quiz-question' prev_question_id %}" class="btn btn-outline-secondary">&laquo; Previous</a>
      {% else %}
        <div></div>
      {% endif %}

      {% if next_question_id %}
        <a href="{% url 'quiz-question' next_question_id %}" class="btn btn-outline-secondary">Next &raquo;</a>
      {% endif %}
    </div>
  {% endif %}

</div>
{% endblock %}
