{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container my-5">

  <!-- âœ… Welcome Banner -->
  <div class="bg-primary text-white text-center p-5 rounded shadow mb-4">
    <h1 class="display-4">{{ settings.site_name|default:"SMARTPACE" }}</h1>
    <p class="lead">{{ settings.tagline|default:"Empowering Minds Through Science" }}</p>
  </div>

  <!-- âœ… Announcement -->
  <div class="alert alert-warning text-center fw-bold">
    ğŸ“¢ {{ settings.announcement|default:"No announcements today." }}
  </div>

  <!-- âœ… Daily Fact -->
  {% if daily_fact %}
    <div class="alert alert-info text-center fw-semibold shadow-sm mb-4">
      ğŸ§¬ <strong>Daily Fact:</strong> {{ daily_fact.text }}
    </div>
  {% else %}
    <div class="alert alert-warning text-center mb-4">
      No daily fact available for today.
    </div>
  {% endif %}

  <!-- âœ… Daily Quote -->
  <div class="my-4 text-center">
    <blockquote class="blockquote">
      <p class="mb-2">â€œ{{ settings.daily_quote|default:"Science is the poetry of reality." }}â€</p>
      <footer class="blockquote-footer">Daily Quote</footer>
    </blockquote>
  </div>

  <!-- âœ… Live Clock -->
  <div class="text-center mb-4">
    <h4 class="fw-semibold">
      ğŸ•’ Current Time: <span id="clock" class="text-success fw-bold"></span>
    </h4>
  </div>

  <!-- âœ… Featured Quiz Categories -->
  <div class="my-5">
    <h3 class="text-center mb-4">ğŸ§  Take a Quiz</h3>
    <div class="row justify-content-center">
      {% for category in quiz_categories %}
      <div class="col-md-3 col-sm-6 mb-3">
        <div class="card text-center border-success h-100 shadow-sm">
          <div class="card-body">
            <h5 class="card-title">{{ category.name }}</h5>
            <a href="{% url 'start_quiz' category.id %}" class="btn btn-outline-success mt-2">
              Take Quiz {% if category.quiz_set.count %}({{ category.quiz_set.count }}){% endif %}
            </a>
          </div>
        </div>
      </div>
      {% empty %}
      <div class="col-12">
        <p class="text-center text-muted">No quizzes available.</p>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- âœ… Collapsible Calendar -->
  <div class="accordion mb-5" id="calendarAccordion">
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingCalendar">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCalendar" aria-expanded="false" aria-controls="collapseCalendar">
          ğŸ“… View Calendar
        </button>
      </h2>
      <div id="collapseCalendar" class="accordion-collapse collapse" aria-labelledby="headingCalendar" data-bs-parent="#calendarAccordion">
        <div class="accordion-body p-0">
          <div class="text-center p-3">
            <iframe
              title="Kenyan Holidays Calendar"
              src="https://calendar.google.com/calendar/embed?src=en.kenyan%23holiday%40group.v.calendar.google.com&ctz=Africa%2FNairobi"
              width="100%" height="300" style="border:0;" frameborder="0" scrolling="no">
            </iframe>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- âœ… Recent Blog Posts -->
  <div class="my-5">
    <h3 class="text-center mb-4">ğŸ“ Recent Blog Posts</h3>
    <div class="row row-cols-1 row-cols-md-3 g-4">
      {% for post in posts %}
      <div class="col">
        <div class="card h-100 shadow-sm">
          {% if post.image %}
          <img src="{{ post.image.url }}" class="card-img-top" alt="{{ post.title|default:'Blog Image' }}">
          {% endif %}
          <div class="card-body">
            <h5 class="card-title">{{ post.title }}</h5>
            <p class="card-text">{{ post.excerpt|truncatewords:20 }}</p>
            <a href="{% url 'post_detail' post.id %}" class="btn btn-primary">Read More</a>
          </div>
          <div class="card-footer text-muted small">
            {{ post.created|date:"M d, Y" }} by {{ post.author.username }}
          </div>
        </div>
      </div>
      {% empty %}
      <div class="col-12">
        <p class="text-center text-muted">No posts available.</p>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- âœ… Upload & Download PDFs -->
  <div class="text-center my-5">
    <a href="{% url 'pdf_upload' %}" class="btn btn-outline-primary btn-lg me-3">
      ğŸ“¤ Upload PDF
    </a>
    <a href="{% url 'pdf_list' %}" class="btn btn-outline-success btn-lg">
      ğŸ“¥ Download PDFs
    </a>
  </div>

</div>

<!-- âœ… Clock Script -->
<script>
  function updateClock() {
    const now = new Date();
    const time = now.toLocaleTimeString([], {
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
      hour12: false
    });
    document.getElementById('clock').innerText = time;
  }
  setInterval(updateClock, 1000);
  updateClock();
</script>
{% endblock %}
